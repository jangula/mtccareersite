generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String
  role      UserRole @default(HR)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("users")
}

model Applicant {
  id              String        @id @default(uuid())
  email           String        @unique
  name            String?
  phone           String?
  gender          Gender?
  race            Race?
  resumePath      String?       @map("resume_path")
  linkedinUrl     String?       @map("linkedin_url")
  bio             String?
  experienceYears Int?          @map("experience_years")
  currentPosition String?       @map("current_position")
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")
  applications    Application[]

  @@map("applicants")
}

model MagicLink {
  id        String        @id @default(uuid())
  email     String
  token     String        @unique
  userType  MagicLinkType @map("user_type")
  expiresAt DateTime      @map("expires_at")
  used      Boolean       @default(false)
  createdAt DateTime      @default(now()) @map("created_at")

  @@map("magic_links")
}

model Job {
  id           String        @id @default(uuid())
  title        String
  department   String
  location     String
  type         JobType       @default(FULL_TIME)
  description  String
  requirements String
  benefits     String?
  salaryRange  String?       @map("salary_range")
  status       JobStatus     @default(DRAFT)
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  closesAt     DateTime?     @map("closes_at")
  applications Application[]

  @@map("jobs")
}

model Application {
  id          String            @id @default(uuid())
  jobId       String            @map("job_id")
  applicantId String            @map("applicant_id")
  coverLetter String?           @map("cover_letter")
  status      ApplicationStatus @default(PENDING)
  createdAt   DateTime          @default(now()) @map("created_at")
  updatedAt   DateTime          @updatedAt @map("updated_at")
  applicant   Applicant         @relation(fields: [applicantId], references: [id], onDelete: Cascade)
  job         Job               @relation(fields: [jobId], references: [id], onDelete: Cascade)
  emailLogs   EmailLog[]

  @@unique([jobId, applicantId])
  @@map("applications")
}

model EmailLog {
  id             String       @id @default(uuid())
  applicationId  String?      @map("application_id")
  recipientEmail String       @map("recipient_email")
  emailType      EmailType    @map("email_type")
  subject        String
  status         String       @default("SENT")
  sentAt         DateTime     @default(now()) @map("sent_at")
  application    Application? @relation(fields: [applicationId], references: [id])

  @@map("email_logs")
}

enum UserRole {
  ADMIN
  HR
}

enum MagicLinkType {
  HR
  APPLICANT
}

enum JobType {
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERNSHIP
}

enum JobStatus {
  DRAFT
  PUBLISHED
  CLOSED
}

enum ApplicationStatus {
  PENDING
  REVIEWED
  SHORTLISTED
  REJECTED
  HIRED
}

enum EmailType {
  MAGIC_LINK
  APPLICATION_RECEIVED
  APPLICATION_REVIEWED
  SHORTLISTED
  REJECTED
  HIRED
}

enum Gender {
  MALE
  FEMALE
}

enum Race {
  BLACK
  COLOURED
  WHITE
  BASTER
}
